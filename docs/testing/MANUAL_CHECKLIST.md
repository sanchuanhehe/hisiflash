# 手动测试清单（Manual Checklist）

> 目标：覆盖当前 `hisiflash` CLI 在真实设备上的关键用户路径、异常路径与回归风险。
>
> 建议在每次发布前至少执行一次完整清单；高风险改动（串口选择、烧录流程、中断处理）后执行增量回归。
>
> 具体操作步骤请参考：`docs/testing/MANUAL_RUNBOOK.md`

## 测试环境信息

- 日期：
- 测试人：
- 主机系统：
- 设备型号：
- 串口：
- 固件文件：
- CLI 版本：
- 提交哈希：

---

## A. 基础可用性

- [ ] `hisiflash --help` 输出正常（语言、命令列表、全局参数齐全）
- [ ] `hisiflash list-ports` 可列出端口
- [ ] 自动识别结果符合预期（例如 `/dev/ttyUSB0`）
- [ ] `--lang en` / `--lang zh-CN` 输出语言正确

## B. 完整烧录主链路

- [ ] `flash <all.fwpkg>` 成功执行到 100%
- [ ] 显示“复位设备/烧录完成”
- [ ] 退出码为 `0`
- [ ] 烧录后设备可正常启动

## C. 烧录后监视器联动

- [ ] `flash ... --monitor` 烧录成功后自动进入 monitor
- [ ] monitor 可正常接收串口输出
- [ ] monitor 退出后串口可再次被 flash 命令占用（无残留占用问题）

## D. monitor 交互与连续切换

- [ ] `Ctrl+T` 切换时间戳（开/关提示正确）
- [ ] `Ctrl+R` 后先显示“复位信号已发送”（动作层结果）
- [ ] `Ctrl+R` 后能显示复位证据分级结果（明确证据 / 弱证据 / 未确认）
- [ ] 当出现启动特征日志（如 `boot.`、`Flash Init`、`verify_*`）时，应判定为“已观察到复位证据”
- [ ] 当仅有静默后新输出（无启动特征）时，应判定为“弱证据（可能已复位）”
- [ ] 当超时内无明确证据时，提示“未观察到明确复位证据”，且保留流控连线提示
- [ ] `Ctrl+C` 可退出 monitor
- [ ] 连续三轮“进入→退出→再进入”稳定

## E. 异常与中断语义

- [ ] `flash` 过程中发送 `SIGINT`，退出码为 `130`
- [ ] `erase` 过程中发送 `SIGINT`，退出码为 `130`
- [ ] `monitor` 过程中发送 `SIGINT`，退出码为 `130`
- [ ] 中断后立即重试命令可成功（说明资源释放正常）

## F. 非TTY与非交互模式

- [ ] 管道/CI 场景触发交互时返回“需要 TTY”的明确错误
- [ ] 非TTY错误退出码为 usage 类（`2`）
- [ ] `monitor` 在非TTY下串口数据输出到 stdout、状态提示输出到 stderr（分流契约）
- [ ] `--non-interactive` 下多串口场景稳定失败并给可操作提示
- [ ] `--non-interactive` + 单候选串口场景可直接执行

## G. 配置优先级与配置异常

- [ ] CLI 参数优先于配置文件
- [ ] 配置文件优先于默认值
- [ ] 环境变量行为符合预期
- [ ] 非法 `chip` 配置能明确报错并返回配置类退出码（`3`）

## H. 输出契约（脚本友好）

- [ ] `--json` 仅在 stdout 输出机器可读结果
- [ ] 人类提示与日志输出在 stderr
- [ ] `-v/-vv` 逐级增加日志
- [ ] `--quiet` 抑制非必要输出

## I. 兼容样本与长期稳定性（可选但推荐）

- [ ] `all.fwpkg` 与 `load_only.fwpkg` 各验证至少一轮
- [ ] 长时间 monitor（例如 30 分钟）无明显异常

---

## 测试结论

- 结论：通过 / 有风险 / 不通过
- 风险点：
- 复现步骤（如有）：
- 建议处理：
